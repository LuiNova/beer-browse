"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}requirejs.config({baseUrl:"src/javascript",paths:{app:"../dist"}}),requirejs(["main"],function(t){t.init()}),define("main",["components/overflow-menu","components/infinite-scroller","datasource/beer"],function(t,e,s){return{init:function(){console.log("App started"),new t;var i=document.querySelector("#beers"),n=new s({url:"https://api.brewerydb.com/v2",menuEndpoint:"/menu",beersEndpoint:"/beers"});i&&(this.infiniteScroller=new e(i,n))}}});var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();define("components/infinite-scroller",[],function(){return function(){function t(e,s,i){_classCallCheck(this,t),i||(i={}),this.scroller=e,this.dataSource=s,this.swipeable=i.swipeable,this.PHYSICAL_ITEMS=i.physicalItems||20,this.PAGE_SIZE=i.pageSize||10,this.PROXIMITY_BOUNDARY=i.proximityBoundary||300,this.itemsCacheData=[],this.loadingItemHeight=0,this.loadingItemWidth=0,this.loadingItems=[],this.physicalItems=[],this.firstPhysicalItemIndex=-1,this.middlePhysicalItemIndex=-1,this.lastPhysicalItemIndex=-1,this.firstPhysicalItem=null,this.lastPhysicalItem=null,this.firstPhysicalItemTranslateY=0,this.lastPhysicalItemTranslateY=0,this.requestInProgress=!1,this.target=null,this.targetBCR=null,this.targetX=0,this.startX=0,this.currentX=0,this.translateX=0,this.draggingItem=!1,this.scrollRunway=document.createElement("div"),this.scrollRunwayEndBefore=0,this.scrollRunwayEnd=0,this.scrollRunway.style.position="absolute",this.scrollRunway.style.height="1px",this.scrollRunway.style.width="1px",this.scrollRunway.style.transition="transform 0.2s",this.scroller.appendChild(this.scrollRunway),this.previousScrollTop=0,this.itemsRemovedInSuccession=0,this.addEventListeners(),this.onResize(),this.loadItems()}return _createClass(t,[{key:"addEventListeners",value:function(){var t=this;window.addEventListener("resize",function(e){return t.onResize(e)}),this.scroller.addEventListener("scroll",function(e){return t.onScroll(e)})}},{key:"onResize",value:function(){var t=this.dataSource.createLoadingElement();this.scroller.appendChild(t),this.loadingItemHeight=t.offsetHeight,this.loadingItemWidth=t.offsetWidth,this.scroller.removeChild(t)}},{key:"onScroll",value:function(){if(!this.requestInProgress){var t=this.scroller.scrollTop-this.previousScrollTop;if(this.previousScrollTop=this.scroller.scrollTop,t>0){var e=this.lastPhysicalItemTranslateY-(this.lastPhysicalItem.offsetHeight+10),s=e-(this.scroller.scrollTop+this.scroller.offsetHeight);!this.requestInProgress&&s<this.PROXIMITY_BOUNDARY&&this.loadItems()}else if(t<0){var i=this.scroller.scrollTop-this.firstPhysicalItemTranslateY;!this.requestInProgress&&0!==this.firstPhysicalItemIndex&&i<this.PROXIMITY_BOUNDARY&&this.loadItemsUp()}}}},{key:"loadItems",value:function(){var t=this;this.requestInProgress=!0;for(var e=this.lastPhysicalItemTranslateY,s=0;s<this.PAGE_SIZE;s+=1){var i=this.loadingItems[s],n=i?this.loadingItems[s]:this.dataSource.createLoadingElement();n.style.position="absolute",n.style.transform="translateY("+e+"px)",n.style.width="92%",n.classList.remove("invisible"),i||this.scroller.appendChild(n),this.loadingItems[s]=n,e+=this.loadingItemHeight+10}var a=this.lastPhysicalItemIndex+1;this.itemsCacheData[a]?this.populateItems(this.itemsCacheData.slice(a,a+10),!0):(this.dataSource.getStyles().then(function(t){console.log("Styles: ",t)}),this.dataSource.getCategories().then(function(t){console.log("Categories: ",t)}),this.dataSource.getBeer().then(function(e){console.log("Beer for Style 1: ",e),t.populateItems(e,!1)}))}},{key:"populateItems",value:function(t,e){for(var s=this.itemsCacheData.length,i=this.lastPhysicalItemIndex+1,n=this.lastPhysicalItemTranslateY,a=0;a<t.length;a+=1){this.loadingItems[a]&&this.loadingItems[a].classList.add("invisible");var r=(i+a)%this.PHYSICAL_ITEMS,o=this.physicalItems[r],l=o?this.dataSource.render(t[a],this.physicalItems[r]):this.dataSource.render(t[a]);l.style.position="absolute",l.style.transform="translateY("+n+"px)",l.dataset.translateY=n,l.style.width="92%",o||this.scroller.appendChild(l),e||(this.scrollRunwayEnd+=l.offsetHeight+10),n+=l.offsetHeight+10,this.physicalItems[r]=l,this.itemsCacheData[s+a]=t[a]}this.calculatePhysicalItemsIndex(t.length),this.scrollRunway.style.transform="translate(0,"+this.scrollRunwayEnd+"px)",this.requestInProgress=!1}},{key:"loadItemsUp",value:function(){this.requestInProgress=!0;for(var t=this.firstPhysicalItemTranslateY,e=9;e>=0;e-=1){var s=this.loadingItems[e],i=s?this.loadingItems[e]:this.dataSource.createLoadingElement();i.style.position="absolute",i.style.transform="translateY("+t+"px)",i.style.width="92%",i.classList.remove("invisible"),s||this.scroller.appendChild(i),this.loadingItems[e]=i,t-=this.loadingItemHeight+10}this.populateItemsTop()}},{key:"populateItemsTop",value:function(){for(var t=this.firstPhysicalItemIndex-1,e=this.firstPhysicalItemTranslateY,s=t;s>t-10;s-=1){this.loadingItems[s%10]&&this.loadingItems[s%10].classList.add("invisible");var i=s%this.PHYSICAL_ITEMS,n=this.physicalItems[i],a=n?this.dataSource.render(this.itemsCacheData[s],this.physicalItems[i]):this.dataSource.render(this.itemsCacheData[s]);a.style.position="absolute",a.style.transform="translateY("+e+"px)",a.dataset.translateY=e,a.style.width="92%",n||this.scroller.appendChild(a),e-=a.offsetHeight+10,this.physicalItems[i]=a}this.calculatePhysicalItemsIndex(-10),this.requestInProgress=!1}},{key:"calculatePhysicalItemsIndex",value:function(t){this.lastPhysicalItemIndex+=t,this.firstPhysicalItemIndex=Math.max(0,this.lastPhysicalItemIndex-(this.PHYSICAL_ITEMS-1)),this.middlePhysicalItemIndex=this.firstPhysicalItemIndex+(this.lastPhysicalItemIndex-this.firstPhysicalItemIndex+1)/2,this.firstPhysicalItem=this.physicalItems[this.firstPhysicalItemIndex%this.PHYSICAL_ITEMS]||this.physicalItems[(this.firstPhysicalItemIndex+this.itemsRemovedInSuccession)%this.PHYSICAL_ITEMS],this.lastPhysicalItem=this.physicalItems[this.lastPhysicalItemIndex%this.PHYSICAL_ITEMS]||this.physicalItems[(this.lastPhysicalItemIndex-this.itemsRemovedInSuccession)%this.PHYSICAL_ITEMS],this.firstPhysicalItemTranslateY=parseInt(this.firstPhysicalItem.dataset.translateY,10)-(this.firstPhysicalItem.offsetHeight+10),this.lastPhysicalItemTranslateY=parseInt(this.lastPhysicalItem.dataset.translateY,10)+(this.lastPhysicalItem.offsetHeight+10),this.itemsRemovedInSuccession=0}}]),t}()});var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();define("components/overflow-menu",[],function(){return function(){function t(){_classCallCheck(this,t),this.el=document.querySelector(".js-side-nav"),this.menuShowEl=document.querySelector(".js-menu-show"),this.menuHideEl=document.querySelector(".js-menu-hide"),this.sideNavContainerEl=document.querySelector(".js-side-nav-container"),this.startY=0,this.currentY=0,this.touchingSideNav=!1,this.supportsPassive=void 0,this.addEventListeners()}return _createClass(t,[{key:"addEventListeners",value:function(){var t=this;this.menuShowEl.addEventListener("click",function(){return t.showSideNav()}),this.menuHideEl.addEventListener("click",function(){return t.hideSideNav()}),this.el.addEventListener("click",function(){return t.hideSideNav()}),this.sideNavContainerEl.addEventListener("click",function(e){return t.blockClicks(e)}),this.el.addEventListener("touchstart",function(e){return t.onTouchStart(e)}),this.el.addEventListener("touchmove",function(e){return t.onTouchMove(e)}),this.el.addEventListener("touchend",function(e){return t.onTouchEnd(e)})}},{key:"onTouchStart",value:function(t){var e=this;this.el.classList.contains("side-nav--visible")&&(this.startY=t.touches[0].pageY,this.currentY=this.startY,this.touchingSideNav=!0,requestAnimationFrame(function(){return e.update()}))}},{key:"onTouchMove",value:function(t){this.touchingSideNav&&(this.currentY=t.touches[0].pageY)}},{key:"onTouchEnd",value:function(){if(this.touchingSideNav){this.touchingSideNav=!1;var t=Math.max(0,this.currentY-this.startY),e=this.sideNavContainerEl.offsetHeight,s=Math.abs(t);this.sideNavContainerEl.style.transform="",s>e/3?this.hideSideNav():this.showSideNav()}}},{key:"update",value:function(){var t=this;if(this.touchingSideNav){requestAnimationFrame(function(){return t.update()});var e=Math.max(0,this.currentY-this.startY);this.sideNavContainerEl.style.transform="translateY("+e+"px)"}}},{key:"blockClicks",value:function(t){t.stopPropagation()}},{key:"onTransitionEnd",value:function(){var t=this;this.el.classList.remove("side-nav--animatable"),this.el.removeEventListener("transitionend",function(){return t.onTransitionEnd()})}},{key:"showSideNav",value:function(){var t=this;this.el.classList.add("side-nav--visible"),this.el.classList.add("side-nav--animatable"),this.el.addEventListener("transitionend",function(){return t.onTransitionEnd()})}},{key:"hideSideNav",value:function(){var t=this;this.el.classList.remove("side-nav--visible"),this.el.classList.add("side-nav--animatable"),this.el.addEventListener("transitionend",function(){return t.onTransitionEnd()})}}]),t}()});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}();define("datasource/beer",[],function(){var t="https://crossorigin.me/",e="a17db91bc77bfdd0d14b4053c5cc0a51";return function(){function s(t){_classCallCheck(this,s),t||(t={}),this.loadingTemplate=document.querySelector("#templates .scroller__item--loading"),this.beerTemplate=document.querySelector("#templates .scroller__item"),this.url=t.url,this.menuEndpoint=t.menuEndpoint,this.beersEndpoint=t.beersEndpoint,this.menuUrl=""+this.url+this.menuEndpoint,this.beerUrl=""+this.url+this.beersEndpoint,this.nextItem=0,this.nextPageToken=null}return _createClass(s,[{key:"fetch",value:function(t){return new Promise(function(e,s){var i=t.params;i&&"object"===(void 0===i?"undefined":_typeof(i))&&(i=Object.keys(i).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(i[t])}).join("&"));var n=i?t.url+"?"+i:t.url,a=new XMLHttpRequest;a.open(t.method||"GET",n),a.onload=function(){a.status>=200&&a.status<300?e(a.response):s(a.statusText)},a.onerror=function(){s(a.statusText)},a.send()})}},{key:"getStyles",value:function(){var s={method:"GET",url:""+t+this.menuUrl+"/styles?key="+e};return this.fetch(s).then(function(t){return JSON.parse(t).data||[]})}},{key:"getCategories",value:function(){var s={method:"GET",url:""+t+this.menuUrl+"/categories?key="+e};return this.fetch(s).then(function(t){return JSON.parse(t).data||[]})}},{key:"getBeer",value:function(){var s=this,i={method:"GET",url:""+t+this.beerUrl+"?key="+e};return this.nextPageToken&&Object.assign(i,{params:{styleId:1}}),this.fetch(i).then(function(t){var e=JSON.parse(t);return s.nextPageToken=e.pageToken,e.data||[]})}},{key:"createLoadingElement",value:function(){return this.loadingTemplate.cloneNode(!0)}},{key:"render",value:function(t,e){return e=e||this.beerTemplate.cloneNode(!0),e.dataset.id=t.id,e.querySelector(".card__title").textContent=t.name,e.querySelector(".card__subtitle").textContent=t.style.shortName,e.querySelector(".card__note").textContent=t.abv+"% ABV"+(t.ibu?", "+t.ibu+" IBU":""),e.querySelector(".card__content").textContent=t.description,e}},{key:"timeSince",value:function(t){"object"!==(void 0===t?"undefined":_typeof(t))&&(t=new Date(t));var e=Math.floor((new Date-t)/1e3),s=Math.floor(e/31536e3);return s>=1?s+" year"+(s>1?"s":"")+" ago":(s=Math.floor(e/2592e3))>=1?s+" month"+(s>1?"s":"")+" ago":(s=Math.floor(e/86400))>=1?s+" day"+(s>1?"s":"")+" ago":(s=Math.floor(e/3600))>=1?s+" hour"+(s>1?"s":"")+" ago":(s=Math.floor(e/3600),s>=1?s+" minute"+(s>1?"s":"")+" ago":s+" second"+(s>1?"s":"")+" ago")}}]),s}()});
//# sourceMappingURL=main.min.js.map
